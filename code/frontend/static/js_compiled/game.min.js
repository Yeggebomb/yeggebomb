'use strict';var n;function p(a){var b=q;function c(){}c.prototype=b.prototype;a.$=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.j=function(a,c,f){b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}}var r={};
function s(a){var b=_.chain(arguments).toArray().rest().flatten().value(),c=a.prototype||a,d={};_(b).each(function(a){_.isString(a)&&(a=r[a]);_(a).each(function(a,b){_.isFunction(a)?c[b]!==a&&(c[b]&&(d[b]=d.hasOwnProperty(b)?d[b]:[c[b]],d[b].push(a)),c[b]=a):_.isArray(a)?c[b]=_.union(a,c[b]||[]):_.isObject(a)?c[b]=_.extend({},a,c[b]||{}):b in c||(c[b]=a)})});_(d).each(function(a,b){c[b]=function(){var b=this,c=arguments,d;_(a).each(function(a){a=_.isFunction(a)?a.apply(b,c):a;d="undefined"===typeof a?
d:a});return d}})};function t(){if(t.prototype.b)return t.prototype.b;t.prototype.b=this;this.e={};window.addEventListener("keyup",this.W.bind(this),!1);window.addEventListener("keydown",this.V.bind(this),!1);document.addEventListener("visibilitychange",this.X.bind(this));document.addEventListener("mousedown",this.U.bind(this))}t.prototype.X=function(){document.hidden&&(this.e=[])};t.prototype.U=function(a){1!=a.which&&(this.e=[])};t.prototype.V=function(a){this.e[a.keyCode]=!0};t.prototype.W=function(a){delete this.e[a.keyCode]};function u(a,b){this.x=a||0;this.y=b||0}function v(a,b){a.x=b.x;a.y=b.y;return a}n=u.prototype;n.clone=function(){return new u(this.x,this.y)};n.rotate=function(a){var b=this.x,c=this.y;this.x=b*Math.cos(a)-c*Math.sin(a);this.y=b*Math.sin(a)+c*Math.cos(a);return this};n.reverse=function(){this.x=-this.x;this.y=-this.y;return this};n.normalize=function(){var a=Math.sqrt(w(this,this));0<a&&(this.x/=a,this.y/=a);return this};n.add=function(a){this.x+=a.x;this.y+=a.y;return this};
n.sub=function(a){this.x-=a.x;this.y-=a.y;return this};n.scale=function(a,b){this.x*=a;this.y*=b||a;return this};function w(a,b){return a.x*b.x+a.y*b.y};function q(a,b,c){this.k=!0;this.C="entity-"+x++;this.a=document.createElement("span");this.a.id=this.C;this.a.classList.add("entity");y.push(this);s(this,"shape");z(this,a,b,c)}var y=[],x=0;q.prototype.update=function(){};q.prototype.f=function(a){a instanceof q&&(a=a.a);document.getElementById(this.C)?console.warn("Attempted to attach dom element multiple times:",this.S):a.appendChild(this.a)};
q.prototype.detach=function(){this.a.parentNode?this.a.parentNode.removeChild(this.a):console.warn("Attempted to remove dom element when it has no parent",this.S)};function A(){if(A.prototype.b)return A.prototype.b;A.prototype.b=this;A.j(this,"constructor");this.a.classList.add(B);s(this,"shape")}p(A);var B="backdrop";function C(){if(C.prototype.b)return C.prototype.b;C.prototype.b=this;C.j(this,"constructor");this.a.classList.add(D);s(this,"shape")}p(C);var D="board";function E(){this.O=this.M=null;this.q=new u;this.I=new u;this.clear()}E.prototype.clear=function(){this.v=this.t=!0;this.p=Number.MAX_VALUE;return this};function F(){if(F.prototype.b)return F.prototype.b;F.prototype.b=this;F.j(this,"constructor");this.a.classList.add(aa);s(this,"shape")}p(F);var aa="root";function G(){if(G.prototype.b)return G.prototype.b;G.prototype.b=this;this.d=new C;this.h=new F;this.u=H;this.F=this.D=0;this.o=[];this.o.push({G:this.d,n:1})}var H=3;G.prototype.watch=function(a,b){this.s=a;this.u=b||H};
G.prototype.update=function(){var a=this.u,b=this.h.height,c=this.h.width,d=this.d.c.x,g=this.d.c.y,f=this.d.width,h=this.d.height,m=c/2,k=b/2;c>f&&console.warn("width is too large");b>h&&console.warn("height is too large");if(null!=this.s){var l=this.s.c.x,e=this.s.c.y;if(1==a||a==H)l>c-m?d=-1*(l-(c-m)):l<d+m&&(d=-1*(l-m)),d=Math.min(Math.max(d,c-f),0);if(2==a||a==H)e>b-k?g=-1*(e-(b-k)):e<g+k&&(g=-1*(e-k)),g=Math.min(Math.max(g,b-h),0)}if(this.D!=d||g!=this.F)this.D=d,this.F=g,_.each(this.o,function(a){z(a.G,
d*a.n,g*a.n)})};function I(){if(I.prototype.b)return I.prototype.b;I.prototype.b=this;s(this,"shape","listenable");J(this.K.bind(this));window.addEventListener("resize",this.Q.bind(this,"resize"));this.K()}I.prototype.K=function(){K(this,document.documentElement.clientWidth,document.documentElement.clientHeight)};function L(){}r.fourway=L.prototype;var M=new t;L.prototype.update=function(){M.e[39]&&(N(this).x+=.6);M.e[37]&&(N(this).x-=.6);M.e[38]&&--N(this).y;M.e[40]&&(N(this).y+=1)};function O(){}r.gravity=O.prototype;O.prototype.update=function(a){var b=N(this);b.y+=.04*a;a=this.c;z(this,a.x+b.x,a.y+b.y)};function P(){}r.listenable=P.prototype;var Q={};function J(a,b){Q.resize||(Q.resize=[]);Q.resize.push(a);_.isBoolean(b)&&b&&a()}P.prototype.Q=function(a){_.each(Q[a],function(a){a()})};function R(){}r.shape=R.prototype;function S(a,b,c,d,g,f,h,m,k,l){a.type=1;a.N=0;a.offset=new u;K(a,d,g,f,h,m,k,l);z(a,b,c,f);a.recalc()}R.prototype.rotate=function(a){for(var b=this.r,c=b.length,d=0;d<c;d++)b[d].rotate(a);this.recalc();return this};R.prototype.translate=function(a,b){for(var c=this.r,d=c.length,g=0;g<d;g++)c[g].x+=a,c[g].y+=b;this.recalc();return this};
function z(a,b,c,d){_.isString(b)&&d&&(b=d.width*parseInt(b,10)/100);_.isString(c)&&d&&(c=d.height*parseInt(c,10)/100);a.c?(a.c.x=b,a.c.y=c):a.c=new u(b,c);_.isNumber(b)&&_.isNumber(c)&&(a.right=b+a.width,a.bottom=c+a.height);a.a&&(b="translate("+b+"px, "+c+"px)",a.a.style.webkitTransform=b,a.a.style.MozTransform=b,a.a.style.msTransform=b,a.a.style.Z=b,a.a.style.transform=b)}
function K(a,b,c,d,g,f,h,m){_.isString(b)&&d&&(b=d.width*parseInt(b,10)/100,_.isNumber(g)&&(b=Math.min(g,b)),_.isNumber(h)&&(b=Math.max(h,b)));_.isString(c)&&d&&(c=d.height*parseInt(c,10)/100,_.isNumber(f)&&(c=Math.min(f,c)),_.isNumber(m)&&(c=Math.max(m,c)));a.width=b;a.height=c;b=a.c;b||(b=a.position=new u);a.right=b.x+a.width;a.bottom=b.y+a.height;a.r=[new u,new u(a.width,0),new u(a.width,a.height),new u(0,a.height)];a.a&&(a.a.style.width=a.width+"px",a.a.style.height=a.height+"px")}
R.prototype.recalc=function(){var a,b=this.w=[],c=[],d=this.H=[],g=this.r||[],f=this.offset||0,h=this.N||0,m=g.length;for(a=0;a<m;a++){var k=g[a].clone();b.push(k);k.x+=f.x;k.y+=f.y;0!==h&&k.rotate(h)}for(a=0;a<m;a++)g=v(new u,a<m-1?b[a+1]:b[0]).sub(b[a]),f=v(new u,g),h=f.x,f.x=f.y,f.y=-h,f=f.normalize(),c.push(g),d.push(f);this.k=!0;return this};var T,U,V;
(function(){for(var a=[],b=0;10>b;b++)a.push(new u);for(var c=[],b=0;5>b;b++)c.push([]);new E;S(new R,0,0,1,1);U=function(a,b,c){for(var h=Number.MAX_VALUE,m=-Number.MAX_VALUE,k=a.length,l=0;l<k;l++){var e=w(a[l],b);e<h&&(h=e);e>m&&(m=e)}c[0]=h;c[1]=m};V=function(b,g,f,h,m,k){var l=c.pop(),e=c.pop();b=v(a.pop(),g).sub(b);g=w(b,m);U(f,m,l);U(h,m,e);e[0]+=g;e[1]+=g;if(l[0]>e[1]||e[0]>l[1])return a.push(b),c.push(l),c.push(e),!0;k&&(f=0,l[0]<e[0]?(k.t=!1,l[1]<e[1]?(f=l[1]-e[0],k.v=!1):(f=l[1]-e[0],h=
e[1]-l[0],f=f<h?f:-h)):(k.v=!1,l[1]>e[1]?(f=l[0]-e[1],k.t=!1):(f=l[1]-e[0],h=e[1]-l[0],f=f<h?f:-h)),h=Math.abs(f),h<k.p&&(k.p=h,v(k.q,m),0>f&&k.q.reverse()));a.push(b);c.push(l);c.push(e);return!1};T=function(a,b,c){for(var h=a.w,m=h.length,k=b.w,l=k.length,e=0;e<m;e++)if(V(a.c,b.c,h,k,a.H[e],c))return!1;for(e=0;e<l;e++)if(V(a.c,b.c,h,k,b.H[e],c))return!1;c&&(c.M=a,c.O=b,v(c.I,c.q).scale(c.p));return!0}}).call(this);function W(){this.i={}}r.physical=W.prototype;var X={};function N(a){a.L||(a.L=new u(0,0));return a.L}W.prototype.update=function(){_.isObject(this.i)||(this.i={});_.each(y,function(a){_.each(this.i,function(b,c){if(a instanceof X[c]){var d=new E;T(this,a,d)&&b(a,d)}}.bind(this))}.bind(this))};function ba(a,b){_.isObject(a.i)||(a.i={});_.isUndefined(X.platform)?console.warn("Warning:","platform","Is not registered as a colideer"):a.i.platform=b};function Y(){Y.j(this,"constructor");this.a.classList.add(ca);s(this,"shape","physical")}p(Y);var ca="platform";function Z(){Z.j(this,"constructor");this.a.classList.add(da);s(this,"shape","gravity","fourway","physical");this.P=.3;this.A=.4}p(Z);var da="player";Z.prototype.R=function(a,b){var c=this.c.sub(b.I),d=N(this);d.y*=-this.P;0<d.x?(d.x-=this.A,0>d.x&&(d.x=0)):(d.x+=this.A,0<d.x&&(d.x=0));z(this,c.x,c.y)};function $(){this.Y=new I;this.h=new F;this.g=new Z;this.m=new G;this.d=new C;this.l=new A;this.T=ea;this.J=new Y;this.B=+new Date;this.f();fa(this);this.update()}var ea=0;function fa(a){J(function(){S(this.h,"25%","25%","50%","50%",this.Y,800,600,400,300)}.bind(a),!0);S(a.J,0,600,1E3,100);S(a.d,0,0,1E3,700);S(a.l,0,0,1E3,700);N(a.g).x=5;S(a.g,0,0,40,50);a.m.watch(a.g);a.m.o.push({G:a.l,n:.3});X.platform=Y;ba(a.g,a.g.R.bind(a.g))}
$.prototype.f=function(){this.h.f(document.body);this.l.f(this.h);this.d.f(this.h);this.g.f(this.d);this.J.f(this.d)};$.prototype.update=function(){if(1!=this.T){window.requestAnimationFrame(this.update.bind(this));var a=+new Date-this.B;this.B=+new Date;this.m.update(a);_.each(y,function(b){b.update(a)});_.each(y,function(a){a.k&&a.k&&(a.k=!1)})}};new $;
