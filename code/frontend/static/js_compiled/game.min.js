'use strict';var n;function r(a){var b=s;function c(){}c.prototype=b.prototype;a.ha=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.l=function(a,c,d){b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}}var v={};
function w(a){var b=_.chain(arguments).toArray().rest().flatten().value(),c=a.prototype||a,e={};_(b).each(function(a){_.isString(a)&&(a=v[a]);_(a).each(function(a,b){_.isFunction(a)?c[b]!==a&&(c[b]&&(e[b]=e.hasOwnProperty(b)?e[b]:[c[b]],e[b].push(a)),c[b]=a):_.isArray(a)?c[b]=_.union(a,c[b]||[]):_.isObject(a)?c[b]=_.extend({},a,c[b]||{}):b in c||(c[b]=a)})});_(e).each(function(a,b){c[b]=function(){var b=this,e=arguments,d;_(a).each(function(a){a=_.isFunction(a)?a.apply(b,e):a;d="undefined"===typeof a?
d:a});return d}})};function x(){if(x.prototype.c)return x.prototype.c;x.prototype.c=this;this.i={};window.addEventListener("keyup",this.ea.bind(this),!1);window.addEventListener("keydown",this.da.bind(this),!1);document.addEventListener("visibilitychange",this.fa.bind(this));document.addEventListener("mousedown",this.ca.bind(this))}x.prototype.fa=function(){document.hidden&&(this.i=[])};x.prototype.ca=function(a){1!=a.which&&(this.i=[])};x.prototype.da=function(a){this.i[a.keyCode]=!0};x.prototype.ea=function(a){delete this.i[a.keyCode]};function y(a,b){this.x=a||0;this.y=b||0}function A(a,b){a.x=b.x;a.y=b.y;return a}n=y.prototype;n.clone=function(){return new y(this.x,this.y)};function aa(a){var b=a.x;a.x=a.y;a.y=-b;return a}n.rotate=function(a){var b=this.x,c=this.y;this.x=b*Math.cos(a)-c*Math.sin(a);this.y=b*Math.sin(a)+c*Math.cos(a);return this};n.reverse=function(){this.x=-this.x;this.y=-this.y;return this};n.normalize=function(){var a=Math.sqrt(B(this,this));0<a&&(this.x/=a,this.y/=a);return this};
n.add=function(a){this.x+=a.x;this.y+=a.y;return this};n.sub=function(a){this.x-=a.x;this.y-=a.y;return this};n.scale=function(a,b){this.x*=a;this.y*=b||a;return this};function B(a,b){return a.x*b.x+a.y*b.y};function C(){this.t=this.s=null;this.o=new y;this.q=new y;this.clear()}C.prototype.clear=function(){this.j=this.p=!0;this.n=Number.MAX_VALUE;return this};function ba(){}v.fourway=ba.prototype;var D=new x;ba.prototype.update=function(){D.i[39]&&(E(this).x+=2);D.i[37]&&(E(this).x-=2);D.i[38]&&(E(this).y-=5);D.i[40]&&(E(this).y+=5)};function ca(){}v.gravity=ca.prototype;ca.prototype.update=function(a){.01<F(this)&&(G(this),F(this));var b=E(this);b.y+=9.8*a;a=this.b;I(this,a.x+b.x,a.y+b.y)};function da(){}v.listenable=da.prototype;var J={};function ea(a,b){J.resize||(J.resize=[]);J.resize.push(a);_.isBoolean(b)&&b&&a()}da.prototype.aa=function(a){_.each(J[a],function(a){a()})};function fa(){}v.reset=fa.prototype;fa.prototype.update=function(){var a=G(this);a.x=0;a.y=0;a=E(this);1E3<a.x&&(a.x=1E3);1E3<a.y&&(a.y=1E3)};function K(){}v.shape=K.prototype;function ga(a){var b=new y(160,120),c=[new y(0,0),new y(60,0),new y(100,40),new y(60,80),new y(0,80)];a.type=0;a.b=b||new y;a.B=c||[];a.N=0;a.offset=new y;a.recalc()}function ha(a){var b=new y(200,0);a.type=2;a.b=b||new y;a.C=20}function L(a,b,c,e,k,d,f,h,l,m){a.type=1;a.N=0;a.offset=new y;ia(a,e,k,d,f,h,l,m);I(a,b,c,d);a.recalc()}K.prototype.rotate=function(a){for(var b=this.B,c=b.length,e=0;e<c;e++)b[e].rotate(a);this.recalc();return this};
K.prototype.translate=function(a,b){for(var c=this.B,e=c.length,k=0;k<e;k++)c[k].x+=a,c[k].y+=b;this.recalc();return this};
function I(a,b,c,e){_.isString(b)&&e&&(b=e.width*parseInt(b,10)/100);_.isString(c)&&e&&(c=e.height*parseInt(c,10)/100);a.b?(a.b.x=b,a.b.y=c):a.b=new y(b,c);_.isNumber(b)&&_.isNumber(c)&&(a.right=b+a.width,a.bottom=c+a.height);a.a&&(b="translate("+b+"px, "+c+"px)",a.a.style.webkitTransform=b,a.a.style.MozTransform=b,a.a.style.msTransform=b,a.a.style.$=b,a.a.style.transform=b)}
function ia(a,b,c,e,k,d,f,h){_.isString(b)&&e&&(b=e.width*parseInt(b,10)/100,_.isNumber(k)&&(b=Math.min(k,b)),_.isNumber(f)&&(b=Math.max(f,b)));_.isString(c)&&e&&(c=e.height*parseInt(c,10)/100,_.isNumber(d)&&(c=Math.min(d,c)),_.isNumber(h)&&(c=Math.max(h,c)));a.width=b;a.height=c;b=a.b;b||(b=a.position=new y);a.right=b.x+a.width;a.bottom=b.y+a.height;a.B=[new y,new y(a.width,0),new y(a.width,a.height),new y(0,a.height)];a.a&&(a.a.style.width=a.width+"px",a.a.style.height=a.height+"px")}
K.prototype.recalc=function(){var a,b=this.u=[],c=this.I=[],e=this.W=[],k=this.B||[],d=this.offset||0,f=this.N||0,h=k.length;for(a=0;a<h;a++){var l=k[a].clone();b.push(l);l.x+=d.x;l.y+=d.y;0!==f&&l.rotate(f)}for(a=0;a<h;a++)k=A(new y,a<h-1?b[a+1]:b[0]).sub(b[a]),d=aa(A(new y,k)).normalize(),c.push(k),e.push(d);this.w=!0;return this};function s(a,b,c){this.w=!0;this.S="entity-"+ja++;this.a=document.createElement("span");this.a.id=this.S;this.a.classList.add("entity");N.push(this);w(this,"shape");I(this,a,b,c)}var N=[],ja=0;s.prototype.update=function(){};s.prototype.e=function(a){a instanceof s&&(a=a.a);document.getElementById(this.S)?console.warn("Attempted to attach dom element multiple times:",this.ba):a.appendChild(this.a)};
s.prototype.detach=function(){this.a.parentNode?this.a.parentNode.removeChild(this.a):console.warn("Attempted to remove dom element when it has no parent",this.ba)};function O(){if(O.prototype.c)return O.prototype.c;O.prototype.c=this;O.l(this,"constructor");this.a.classList.add(ka);w(this,"shape")}r(O);var ka="backdrop";function P(){if(P.prototype.c)return P.prototype.c;P.prototype.c=this;P.l(this,"constructor");this.a.classList.add(la);w(this,"shape")}r(P);var la="board";function Q(){Q.l(this,"constructor");this.a.classList.add(ma);w(this,"shape","gravity","physical")}r(Q);var ma="platform";Q.prototype.G=function(a,b){var c=this.b.sub(b.q),e=E(this);e.y*=-this.P;0<e.x?(e.x-=this.v,0>e.x&&(e.x=0)):(e.x+=this.v,0<e.x&&(e.x=0));I(this,c.x,c.y)};var na,R,oa,S,pa,T;
(function(){for(var a=[],b=0;10>b;b++)a.push(new y);for(var c=[],b=0;5>b;b++)c.push([]);new C;L(new K,0,0,1,1);S=function(a,b,d){for(var c=Number.MAX_VALUE,h=-Number.MAX_VALUE,l=a.length,m=0;m<l;m++){var g=B(a[m],b);g<c&&(c=g);g>h&&(h=g)}d[0]=c;d[1]=h};pa=function(b,k,d,f,h,l){var m=c.pop(),g=c.pop();b=A(a.pop(),k).sub(b);k=B(b,h);S(d,h,m);S(f,h,g);g[0]+=k;g[1]+=k;if(m[0]>g[1]||g[0]>m[1])return a.push(b),c.push(m),c.push(g),!0;l&&(d=0,m[0]<g[0]?(l.p=!1,m[1]<g[1]?(d=m[1]-g[0],l.j=!1):(d=m[1]-g[0],
f=g[1]-m[0],d=d<f?d:-f)):(l.j=!1,m[1]>g[1]?(d=m[0]-g[1],l.p=!1):(d=m[1]-g[0],f=g[1]-m[0],d=d<f?d:-f)),f=Math.abs(d),f<l.n&&(l.n=f,A(l.o,h),0>d&&l.o.reverse()));a.push(b);c.push(m);c.push(g);return!1};T=function(a,b){var d=B(a,a),c=B(b,a);return 0>c?-1:c>d?1:0};R=function(b,c,d){for(var f=A(a.pop(),c.b).sub(b.b),h=c.C,l=h*h,m=b.u,g=m.length,t=a.pop(),p=a.pop(),z=0;z<g;z++){var u=z===g-1?0:z+1,V=0===z?g-1:z-1,H=0,M=null;A(t,b.I[z]);A(p,f).sub(m[z]);d&&B(p,p)>l&&(d.p=!1);var q=T(t,p);if(-1===q){A(t,
b.I[V]);u=A(a.pop(),f).sub(m[V]);q=T(t,u);if(1===q){q=Math.sqrt(B(p,p));if(q>h)return a.push(f),a.push(t),a.push(p),a.push(u),!1;d&&(d.j=!1,M=p.normalize(),H=h-q)}a.push(u)}else if(1===q){if(A(t,b.I[u]),A(p,f).sub(m[u]),q=T(t,p),-1===q){q=Math.sqrt(B(p,p));if(q>h)return a.push(f),a.push(t),a.push(p),!1;d&&(d.j=!1,M=p.normalize(),H=h-q)}}else{u=aa(t).normalize();q=B(p,u);V=Math.abs(q);if(0<q&&V>h)return a.push(f),a.push(u),a.push(p),!1;d&&(M=u,H=h-q,0<=q||H<2*h)&&(d.j=!1)}M&&d&&Math.abs(H)<Math.abs(d.n)&&
(d.n=H,A(d.o,M))}d&&(d.s=b,d.t=c,A(d.q,d.o).scale(d.n));a.push(f);a.push(t);a.push(p);return!0};oa=function(a,b,c){if((a=R(b,a,f))&&c){var f=c;c=f.s;b=f.p;f.o.reverse();f.q.reverse();f.s=f.t;f.t=c;f.p=f.j;f.j=b}return a};na=function(a,b,c){for(var f=a.u,h=f.length,l=b.u,m=l.length,g=0;g<h;g++)if(pa(a.b,b.b,f,l,a.W[g],c))return!1;for(g=0;g<m;g++)if(pa(a.b,b.b,f,l,b.W[g],c))return!1;c&&(c.s=a,c.t=b,A(c.q,c.o).scale(c.n));return!0}}).call(this);function U(){if(U.prototype.c)return U.prototype.c;U.prototype.c=this;U.l(this,"constructor");this.a.classList.add(qa);w(this,"shape")}r(U);var qa="root";function W(){if(W.prototype.c)return W.prototype.c;W.prototype.c=this;this.d=new P;this.k=new U;this.O=X;this.U=this.T=0;this.J=[];this.J.push({V:this.d,H:1})}var X=3;W.prototype.watch=function(a,b){this.L=a;this.O=b||X};
W.prototype.update=function(){var a=this.O,b=this.k.height,c=this.k.width,e=this.d.b.x,k=this.d.b.y,d=this.d.width,f=this.d.height,h=c/2,l=b/2;c>d&&console.warn("width is too large");b>f&&console.warn("height is too large");if(null!=this.L){var m=this.L.b.x,g=this.L.b.y;if(1==a||a==X)m>c-h?e=-1*(m-(c-h)):m<e+h&&(e=-1*(m-h)),e=Math.min(Math.max(e,c-d),0);if(2==a||a==X)g>b-l?k=-1*(g-(b-l)):g<k+l&&(k=-1*(g-l)),k=Math.min(Math.max(k,b-f),0)}if(this.T!=e||k!=this.U)this.T=e,this.U=k,_.each(this.J,function(a){I(a.V,
e*a.H,k*a.H)})};function Y(){if(Y.prototype.c)return Y.prototype.c;Y.prototype.c=this;w(this,"shape","listenable");ea(this.X.bind(this));window.addEventListener("resize",this.aa.bind(this,"resize"));this.X()}Y.prototype.X=function(){ia(this,document.documentElement.clientWidth,document.documentElement.clientHeight)};function ra(){this.m={}}v.physical=ra.prototype;var sa={};function G(a){a.M||(a.M=new y(0,0));return a.M}function E(a){a.Z||(a.Z=new y(0,0));return a.Z}function F(a){a.A||(a.A=0);return a.A}ra.prototype.step=function(a){if(.01<F(this)){.01<F(this)&&(G(this).y+=9.8);var b=G(this),c=E(this);c.x+=b.x*a;c.y+=b.y*a;var b=G(this),c=E(this),e=this.b;e.x+=c.x*a+.5*b.x*a*a;e.y+=c.y*a+.5*b.y*a*a}a=this.b;I(this,a.x,a.y)};
ra.prototype.update=function(a){this.step(a);_.isObject(this.m)||(this.m={});_.each(N,function(b){_.each(this.m,function(c,e){if(b instanceof sa[e]){var k=new C,d=!1;if(0!=this.type&&1!=this.type||0!=b.type&&1!=b.type)if(2!=this.type||0!=b.type&&1!=b.type)0!=this.type&&1!=this.type||2!=b.type||(d=R(this,b,k));else{if(d=oa(this,b,k))debugger}else d=na(this,b,k);d&&c(b,k,a)}}.bind(this))}.bind(this))};
function ta(a,b){_.isObject(a.m)||(a.m={});_.isUndefined(sa.platform)?console.warn("Warning:","platform","Is not registered as a colideer"):a.m.platform=b};function Z(){Z.l(this,"constructor");this.a.classList.add(ua);w(this,"shape","physical")}r(Z);var ua="platform";function $(){$.l(this,"constructor");this.a.classList.add(va);w(this,"shape","reset","fourway","physical");this.v=this.P=.5;this.Q=.01;this.A=3}r($);var va="player";$.prototype.G=function(a,b,c){a=this.b.sub(b.q);b=E(this);b.y*=-this.P;b.x>this.Q?(b.x-=9.8*this.v*c,0>b.x&&(b.x=0)):b.x<this.Q?(b.x+=9.8*this.v*c,0<b.x&&(b.x=0)):b.x=0;I(this,a.x,a.y)};function wa(){this.ga=new Y;this.k=new U;this.h=new $;this.F=new W;this.d=new P;this.D=new O;this.g=xa;this.K=new Z;this.Y=new Z;this.r=new Q;this.R=+new Date;this.f=15;this.e();ya(this);this.update()}var xa=0;
function ya(a){ea(function(){L(this.k,"25%","25%","50%","50%",this.ga,800,600,400,300)}.bind(a),!0);ga(a.Y);ha(a.r);L(a.K,0,600,1E3,100);a.K.a.classList.add("ground");L(a.d,0,0,1E3,700);L(a.D,0,0,1E3,700);E(a.h).x=5;L(a.h,0,0,40,50);a.h.A=5;a.F.watch(a.h);a.F.J.push({V:a.D,H:.3});sa.platform=Z;ta(a.h,a.h.G.bind(a.h));ta(a.r,a.r.G.bind(a.r))}wa.prototype.e=function(){this.k.e(document.body);this.D.e(this.k);this.d.e(this.k);this.h.e(this.d);this.K.e(this.d);this.Y.e(this.d);this.r.e(this.d)};
wa.prototype.update=function(){var a=+new Date,b=a-this.R;this.f-=b/1E3;if(this.g==xa){var c=b/100;this.F.update(c);_.each(N,function(a){a.update(c)});_.each(N,function(a){if(a.w&&a.w&&(a.w=!1,1!=a.type)){var b=a.a.getElementsByTagName("svg");1==b.length?b=b[0]:(b=document.createElementNS("http://www.w3.org/2000/svg","svg"),a.a.appendChild(b));if(0==a.type){var c=b.getElementsByTagName("path");1==c.length?c=c[0]:(c=document.createElementNS("http://www.w3.org/2000/svg","path"),b.appendChild(c));var f=
a.u,h;h="M0 0"+("M"+f[0].x+" "+f[0].y);for(var l=1;l<f.length;l++){var m=f[l];h+="L"+m.x+" "+m.y}c.setAttributeNS(null,"d",h+"Z")}2==a.type&&(c=b.getElementsByTagName("circle"),1==c.length?c=c[0]:(c=document.createElementNS("http://www.w3.org/2000/svg","circle"),b.appendChild(c)),c.setAttributeNS(null,"r",a.C),c.setAttributeNS(null,"cx",a.C),c.setAttributeNS(null,"cy",a.C),c.setAttributeNS(null,"fill","black"));a=a.b;a="translate("+a.x+"px, "+a.y+"px)";b.style.webkitTransform=a;b.style.MozTransform=
a;b.style.msTransform=a;b.style.$=a;b.style.transform=a}});0>this.f&&(this.g=this.f=1)}1==this.g&&(this.f=5,this.g=2);2==this.g&&0>this.f&&(this.f=15,this.g=3);3==this.g&&0>this.f&&(this.f=15,this.g=xa);this.R=a;window.requestAnimationFrame(this.update.bind(this))};new wa;
