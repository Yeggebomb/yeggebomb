'use strict';var n;function r(a){var b=s;function c(){}c.prototype=b.prototype;a.ga=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.j=function(a,c,d){b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}}var v={};
function w(a){var b=_.chain(arguments).toArray().rest().flatten().value(),c=a.prototype||a,e={};_(b).each(function(a){_.isString(a)&&(a=v[a]);_(a).each(function(a,b){_.isFunction(a)?c[b]!==a&&(c[b]&&(e[b]=e.hasOwnProperty(b)?e[b]:[c[b]],e[b].push(a)),c[b]=a):_.isArray(a)?c[b]=_.union(a,c[b]||[]):_.isObject(a)?c[b]=_.extend({},a,c[b]||{}):b in c||(c[b]=a)})});_(e).each(function(a,b){c[b]=function(){var b=this,c=arguments,e;_(a).each(function(a){a=_.isFunction(a)?a.apply(b,c):a;e="undefined"===typeof a?
e:a});return e}})};function x(){if(x.prototype.c)return x.prototype.c;x.prototype.c=this;this.g={};window.addEventListener("keyup",this.da.bind(this),!1);window.addEventListener("keydown",this.ca.bind(this),!1);document.addEventListener("visibilitychange",this.ea.bind(this));document.addEventListener("mousedown",this.ba.bind(this))}x.prototype.ea=function(){document.hidden&&(this.g=[])};x.prototype.ba=function(a){1!=a.which&&(this.g=[])};x.prototype.ca=function(a){this.g[a.keyCode]=!0};x.prototype.da=function(a){delete this.g[a.keyCode]};function y(a,b){this.x=a||0;this.y=b||0}function A(a,b){a.x=b.x;a.y=b.y;return a}n=y.prototype;n.clone=function(){return new y(this.x,this.y)};function aa(a){var b=a.x;a.x=a.y;a.y=-b;return a}n.rotate=function(a){var b=this.x,c=this.y;this.x=b*Math.cos(a)-c*Math.sin(a);this.y=b*Math.sin(a)+c*Math.cos(a);return this};n.reverse=function(){this.x=-this.x;this.y=-this.y;return this};n.normalize=function(){var a=Math.sqrt(B(this,this));0<a&&(this.x/=a,this.y/=a);return this};
n.add=function(a){this.x+=a.x;this.y+=a.y;return this};n.sub=function(a){this.x-=a.x;this.y-=a.y;return this};n.scale=function(a,b){this.x*=a;this.y*=b||a;return this};function B(a,b){return a.x*b.x+a.y*b.y};function C(){this.r=this.q=null;this.m=new y;this.o=new y;this.clear()}C.prototype.clear=function(){this.h=this.n=!0;this.l=Number.MAX_VALUE;return this};function ba(){}v.fourway=ba.prototype;var D=new x;ba.prototype.update=function(){D.g[39]&&(E(this).x+=2);D.g[37]&&(E(this).x-=2);D.g[38]&&(E(this).y-=5);D.g[40]&&(E(this).y+=5)};function ca(){}v.gravity=ca.prototype;ca.prototype.update=function(a){.01<F(this)&&(G(this),F(this));var b=E(this);b.y+=9.8*a;a=this.b;I(this,a.x+b.x,a.y+b.y)};function da(){}v.listenable=da.prototype;var J={};function ea(a,b){J.resize||(J.resize=[]);J.resize.push(a);_.isBoolean(b)&&b&&a()}da.prototype.Z=function(a){_.each(J[a],function(a){a()})};function fa(){}v.reset=fa.prototype;fa.prototype.update=function(){var a=G(this);a.x=0;a.y=0;a=E(this);1E3<a.x&&(a.x=1E3);1E3<a.y&&(a.y=1E3)};function K(){}v.shape=K.prototype;function ga(a){var b=new y(160,120),c=[new y(0,0),new y(60,0),new y(100,40),new y(60,80),new y(0,80)];a.type=0;a.b=b||new y;a.w=c||[];a.L=0;a.offset=new y;a.recalc()}function ha(a){var b=new y(200,0);a.type=2;a.b=b||new y;a.A=20}function L(a,b,c,e,g,d,f,k,l,m){a.type=1;a.L=0;a.offset=new y;ia(a,e,g,d,f,k,l,m);I(a,b,c,d);a.recalc()}K.prototype.rotate=function(a){for(var b=this.w,c=b.length,e=0;e<c;e++)b[e].rotate(a);this.recalc();return this};
K.prototype.translate=function(a,b){for(var c=this.w,e=c.length,g=0;g<e;g++)c[g].x+=a,c[g].y+=b;this.recalc();return this};
function I(a,b,c,e){_.isString(b)&&e&&(b=e.width*parseInt(b,10)/100);_.isString(c)&&e&&(c=e.height*parseInt(c,10)/100);a.b?(a.b.x=b,a.b.y=c):a.b=new y(b,c);_.isNumber(b)&&_.isNumber(c)&&(a.right=b+a.width,a.bottom=c+a.height);a.a&&(b="translate("+b+"px, "+c+"px)",a.a.style.webkitTransform=b,a.a.style.MozTransform=b,a.a.style.msTransform=b,a.a.style.Y=b,a.a.style.transform=b)}
function ia(a,b,c,e,g,d,f,k){_.isString(b)&&e&&(b=e.width*parseInt(b,10)/100,_.isNumber(g)&&(b=Math.min(g,b)),_.isNumber(f)&&(b=Math.max(f,b)));_.isString(c)&&e&&(c=e.height*parseInt(c,10)/100,_.isNumber(d)&&(c=Math.min(d,c)),_.isNumber(k)&&(c=Math.max(k,c)));a.width=b;a.height=c;b=a.b;b||(b=a.position=new y);a.right=b.x+a.width;a.bottom=b.y+a.height;a.w=[new y,new y(a.width,0),new y(a.width,a.height),new y(0,a.height)];a.a&&(a.a.style.width=a.width+"px",a.a.style.height=a.height+"px")}
K.prototype.recalc=function(){var a,b=this.s=[],c=this.G=[],e=this.U=[],g=this.w||[],d=this.offset||0,f=this.L||0,k=g.length;for(a=0;a<k;a++){var l=g[a].clone();b.push(l);l.x+=d.x;l.y+=d.y;0!==f&&l.rotate(f)}for(a=0;a<k;a++)g=A(new y,a<k-1?b[a+1]:b[0]).sub(b[a]),d=aa(A(new y,g)).normalize(),c.push(g),e.push(d);this.u=!0;return this};function s(a,b,c){this.u=!0;this.Q="entity-"+ja++;this.a=document.createElement("span");this.a.id=this.Q;this.a.classList.add("entity");N.push(this);w(this,"shape");I(this,a,b,c)}var N=[],ja=0;s.prototype.update=function(){};s.prototype.e=function(a){a instanceof s&&(a=a.a);document.getElementById(this.Q)?console.warn("Attempted to attach dom element multiple times:",this.$):a.appendChild(this.a)};
s.prototype.detach=function(){this.a.parentNode?this.a.parentNode.removeChild(this.a):console.warn("Attempted to remove dom element when it has no parent",this.$)};function O(){if(O.prototype.c)return O.prototype.c;O.prototype.c=this;O.j(this,"constructor");this.a.classList.add(ka);w(this,"shape")}r(O);var ka="backdrop";function P(){if(P.prototype.c)return P.prototype.c;P.prototype.c=this;P.j(this,"constructor");this.a.classList.add(la);w(this,"shape")}r(P);var la="board";function Q(){Q.j(this,"constructor");this.a.classList.add(ma);w(this,"shape","gravity","physical")}r(Q);var ma="platform";Q.prototype.D=function(a,b){var c=this.b.sub(b.o),e=E(this);e.y*=-this.N;0<e.x?(e.x-=this.t,0>e.x&&(e.x=0)):(e.x+=this.t,0<e.x&&(e.x=0));I(this,c.x,c.y)};var na,R,oa,S,pa,T;
(function(){for(var a=[],b=0;10>b;b++)a.push(new y);for(var c=[],b=0;5>b;b++)c.push([]);new C;L(new K,0,0,1,1);S=function(a,b,c){for(var f=Number.MAX_VALUE,k=-Number.MAX_VALUE,l=a.length,m=0;m<l;m++){var h=B(a[m],b);h<f&&(f=h);h>k&&(k=h)}c[0]=f;c[1]=k};pa=function(b,g,d,f,k,l){var m=c.pop(),h=c.pop();b=A(a.pop(),g).sub(b);g=B(b,k);S(d,k,m);S(f,k,h);h[0]+=g;h[1]+=g;if(m[0]>h[1]||h[0]>m[1])return a.push(b),c.push(m),c.push(h),!0;l&&(d=0,m[0]<h[0]?(l.n=!1,m[1]<h[1]?(d=m[1]-h[0],l.h=!1):(d=m[1]-h[0],
f=h[1]-m[0],d=d<f?d:-f)):(l.h=!1,m[1]>h[1]?(d=m[0]-h[1],l.n=!1):(d=m[1]-h[0],f=h[1]-m[0],d=d<f?d:-f)),f=Math.abs(d),f<l.l&&(l.l=f,A(l.m,k),0>d&&l.m.reverse()));a.push(b);c.push(m);c.push(h);return!1};T=function(a,b){var c=B(a,a),f=B(b,a);return 0>f?-1:f>c?1:0};R=function(b,c,d){for(var f=A(a.pop(),c.b).sub(b.b),k=c.A,l=k*k,m=b.s,h=m.length,t=a.pop(),p=a.pop(),z=0;z<h;z++){var u=z===h-1?0:z+1,V=0===z?h-1:z-1,H=0,M=null;A(t,b.G[z]);A(p,f).sub(m[z]);d&&B(p,p)>l&&(d.n=!1);var q=T(t,p);if(-1===q){A(t,
b.G[V]);u=A(a.pop(),f).sub(m[V]);q=T(t,u);if(1===q){q=Math.sqrt(B(p,p));if(q>k)return a.push(f),a.push(t),a.push(p),a.push(u),!1;d&&(d.h=!1,M=p.normalize(),H=k-q)}a.push(u)}else if(1===q){if(A(t,b.G[u]),A(p,f).sub(m[u]),q=T(t,p),-1===q){q=Math.sqrt(B(p,p));if(q>k)return a.push(f),a.push(t),a.push(p),!1;d&&(d.h=!1,M=p.normalize(),H=k-q)}}else{u=aa(t).normalize();q=B(p,u);V=Math.abs(q);if(0<q&&V>k)return a.push(f),a.push(u),a.push(p),!1;d&&(M=u,H=k-q,0<=q||H<2*k)&&(d.h=!1)}M&&d&&Math.abs(H)<Math.abs(d.l)&&
(d.l=H,A(d.m,M))}d&&(d.q=b,d.r=c,A(d.o,d.m).scale(d.l));a.push(f);a.push(t);a.push(p);return!0};oa=function(a,b,c){if((a=R(b,a,f))&&c){var f=c;c=f.q;b=f.n;f.m.reverse();f.o.reverse();f.q=f.r;f.r=c;f.n=f.h;f.h=b}return a};na=function(a,b,c){for(var f=a.s,k=f.length,l=b.s,m=l.length,h=0;h<k;h++)if(pa(a.b,b.b,f,l,a.U[h],c))return!1;for(h=0;h<m;h++)if(pa(a.b,b.b,f,l,b.U[h],c))return!1;c&&(c.q=a,c.r=b,A(c.o,c.m).scale(c.l));return!0}}).call(this);function U(){if(U.prototype.c)return U.prototype.c;U.prototype.c=this;U.j(this,"constructor");this.a.classList.add(qa);w(this,"shape")}r(U);var qa="root";function W(){if(W.prototype.c)return W.prototype.c;W.prototype.c=this;this.d=new P;this.i=new U;this.M=X;this.S=this.R=0;this.H=[];this.H.push({T:this.d,F:1})}var X=3;W.prototype.watch=function(a,b){this.J=a;this.M=b||X};
W.prototype.update=function(){var a=this.M,b=this.i.height,c=this.i.width,e=this.d.b.x,g=this.d.b.y,d=this.d.width,f=this.d.height,k=c/2,l=b/2;c>d&&console.warn("width is too large");b>f&&console.warn("height is too large");if(null!=this.J){var m=this.J.b.x,h=this.J.b.y;if(1==a||a==X)m>c-k?e=-1*(m-(c-k)):m<e+k&&(e=-1*(m-k)),e=Math.min(Math.max(e,c-d),0);if(2==a||a==X)h>b-l?g=-1*(h-(b-l)):h<g+l&&(g=-1*(h-l)),g=Math.min(Math.max(g,b-f),0)}if(this.R!=e||g!=this.S)this.R=e,this.S=g,_.each(this.H,function(a){I(a.T,
e*a.F,g*a.F)})};function Y(){if(Y.prototype.c)return Y.prototype.c;Y.prototype.c=this;w(this,"shape","listenable");ea(this.V.bind(this));window.addEventListener("resize",this.Z.bind(this,"resize"));this.V()}Y.prototype.V=function(){ia(this,document.documentElement.clientWidth,document.documentElement.clientHeight)};function ra(){this.k={}}v.physical=ra.prototype;var sa={};function G(a){a.K||(a.K=new y(0,0));return a.K}function E(a){a.X||(a.X=new y(0,0));return a.X}function F(a){a.v||(a.v=0);return a.v}ra.prototype.step=function(a){if(.01<F(this)){.01<F(this)&&(G(this).y+=9.8);var b=G(this),c=E(this);c.x+=b.x*a;c.y+=b.y*a;var b=G(this),c=E(this),e=this.b;e.x+=c.x*a+.5*b.x*a*a;e.y+=c.y*a+.5*b.y*a*a}a=this.b;I(this,a.x,a.y)};
ra.prototype.update=function(a){this.step(a);_.isObject(this.k)||(this.k={});_.each(N,function(b){_.each(this.k,function(c,e){if(b instanceof sa[e]){var g=new C,d=!1;if(0!=this.type&&1!=this.type||0!=b.type&&1!=b.type)if(2!=this.type||0!=b.type&&1!=b.type)0!=this.type&&1!=this.type||2!=b.type||(d=R(this,b,g));else{if(d=oa(this,b,g))debugger}else d=na(this,b,g);d&&c(b,g,a)}}.bind(this))}.bind(this))};
function ta(a,b){_.isObject(a.k)||(a.k={});_.isUndefined(sa.platform)?console.warn("Warning:","platform","Is not registered as a colideer"):a.k.platform=b};function Z(){Z.j(this,"constructor");this.a.classList.add(ua);w(this,"shape","physical")}r(Z);var ua="platform";function $(){$.j(this,"constructor");this.a.classList.add(va);w(this,"shape","reset","fourway","physical");this.t=this.N=.5;this.O=.01;this.v=3}r($);var va="player";$.prototype.D=function(a,b,c){a=this.b.sub(b.o);b=E(this);b.y*=-this.N;b.x>this.O?(b.x-=9.8*this.t*c,0>b.x&&(b.x=0)):b.x<this.O?(b.x+=9.8*this.t*c,0<b.x&&(b.x=0)):b.x=0;I(this,a.x,a.y)};function wa(){this.fa=new Y;this.i=new U;this.f=new $;this.C=new W;this.d=new P;this.B=new O;this.aa=xa;this.I=new Z;this.W=new Z;this.p=new Q;this.P=+new Date;this.e();ya(this);this.update()}var xa=0;
function ya(a){ea(function(){L(this.i,"25%","25%","50%","50%",this.fa,800,600,400,300)}.bind(a),!0);ga(a.W);ha(a.p);L(a.I,0,600,1E3,100);a.I.a.classList.add("ground");L(a.d,0,0,1E3,700);L(a.B,0,0,1E3,700);E(a.f).x=5;L(a.f,0,0,40,50);a.f.v=5;a.C.watch(a.f);a.C.H.push({T:a.B,F:.3});sa.platform=Z;ta(a.f,a.f.D.bind(a.f));ta(a.p,a.p.D.bind(a.p))}wa.prototype.e=function(){this.i.e(document.body);this.B.e(this.i);this.d.e(this.i);this.f.e(this.d);this.I.e(this.d);this.W.e(this.d);this.p.e(this.d)};
wa.prototype.update=function(){if(1!=this.aa){window.requestAnimationFrame(this.update.bind(this));var a=+new Date,b=(a-this.P)/100;this.P=a;this.C.update(b);_.each(N,function(a){a.update(b)});_.each(N,function(a){if(a.u&&a.u&&(a.u=!1,1!=a.type)){var b=a.a.getElementsByTagName("svg");1==b.length?b=b[0]:(b=document.createElementNS("http://www.w3.org/2000/svg","svg"),a.a.appendChild(b));if(0==a.type){var g=b.getElementsByTagName("path");1==g.length?g=g[0]:(g=document.createElementNS("http://www.w3.org/2000/svg",
"path"),b.appendChild(g));var d=a.s,f;f="M0 0"+("M"+d[0].x+" "+d[0].y);for(var k=1;k<d.length;k++){var l=d[k];f+="L"+l.x+" "+l.y}g.setAttributeNS(null,"d",f+"Z")}2==a.type&&(g=b.getElementsByTagName("circle"),1==g.length?g=g[0]:(g=document.createElementNS("http://www.w3.org/2000/svg","circle"),b.appendChild(g)),g.setAttributeNS(null,"r",a.A),g.setAttributeNS(null,"cx",a.A),g.setAttributeNS(null,"cy",a.A),g.setAttributeNS(null,"fill","black"));a=a.b;a="translate("+a.x+"px, "+a.y+"px)";b.style.webkitTransform=
a;b.style.MozTransform=a;b.style.msTransform=a;b.style.Y=a;b.style.transform=a}})}};new wa;
